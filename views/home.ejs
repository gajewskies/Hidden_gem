<!DOCTYPE html>
<html>
	<head>
		
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    	<meta charset="utf-8">
    		<title>Home Page</title>
		<link rel="stylesheet" href="/styles.css">
		<!--http://t4t5.github.io/sweetalert/
		<script src="/home/Tyler/Documents/Senior_project/Hidden_gem/node_modules/sweetalert/dist/sweetalert.min.js"></script>
		<link rel="stylesheet" type="text/css" href="/home/Tyler/Documents/Senior_project/Hidden_gem/node_modules/sweetalert/dist/sweetalert.css">
		-->
		<script src="/index.js"></script>
    
    	<style>
			html, body, #map-canvas {
	    		height: 97%;
	    		margin: 0px;
	    		padding: 0px;
	    		top: 50px;
	  		}
	  		#toolbar {
	  			position: absolute;
	  			top: 0px;
	  			left: 0px;
	  			width: 100%;
	  			color: #fff;
		  	}
    	</style>

  </head>

  <body>
  	<div id="map-canvas"></div>
  	<div id="toolbar">
		<div id='menu'>
			<ul>
			   <li class='active'><a href='#'>Home</a></li>
			   <li><a onclick="addGemLoc()" href='#'>New</a></li>
			   <li><a onclick="removeGemLoc()" href='#'>Remove</a></li>
			   <li><a href='find()'>Find</a></li>
			   <li><a href='account'>Account</a></li>
			   <li><a href='settings'>Settings</a></li>
			   <li><a href='/logout'>Log Out</a></li>
			</ul>
		</div>
	</div>
  </body>

  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true"></script>
  <script src="/home/Tyler/Documents/Senior_project/Hidden_gem/Geolocation.js"></script>
  <script>
  		var map;
  		var initialLocation;
  		var markers = [];

		function initialize() {
			var browserSupportFlag =  new Boolean();
			var home = new google.maps.LatLng(42.479965, -79.342213);

			var mapOptions = {
			    zoom: 4,
			    center: new google.maps.LatLng(40.714985, -99.102617),
			    mapTypeControl: true,
			    mapTypeControlOptions: {
			        style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
			        position: google.maps.ControlPosition.BOTTOM_CENTER
			    },
			    zoomControl: true,
			    zoomControlOptions: {
			        style: google.maps.ZoomControlStyle.LARGE,
			        position: google.maps.ControlPosition.LEFT_CENTER
			    },
			    scaleControl: true,
			    streetViewControl: true,
			    streetViewControlOptions: {
			        position: google.maps.ControlPosition.LEFT_TOP
			    }
			  }
			  map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

		function handleNoGeolocation(errorFlag) {
		    if (errorFlag == true) {
		    	alert("Geolocation service failed.");
		    } else {
		    	alert("Your browser doesn't support geolocation");
		    }
		  }
		}

	   // Try W3C Geolocation (Preferred)
		if(navigator.geolocation) {
	    	browserSupportFlag = true;
	    	navigator.geolocation.getCurrentPosition(function(position) {
	      		initialLocation = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
	      		//map.setCenter(initialLocation);
	      		console.log(initialLocation);
	    	}, function() {
	      		handleNoGeolocation(browserSupportFlag);
	    	});
	  	} else { // Browser doesn't support Geolocation
			browserSupportFlag = false;
	    	handleNoGeolocation(browserSupportFlag);
	  	}

		function addGemLoc() { //function that will add markers on button click
			map.setCenter(initialLocation);
		    var marker = new google.maps.Marker({
		        position:initialLocation,
		        map: map,
		            draggable:true,
		            animation: google.maps.Animation.DROP,
			        title:"This a new marker!",
		        icon: "http://maps.google.com/mapfiles/ms/micons/blue.png"
		    });
		    markers.push(marker);
		    console.log(marker);

		    var name = GemName();
		    var description = GemDescription();
		    var image = "<img id='teet' src='/homepic.png' width='125px' height='125px'>"
		    var content = "" + name + "<br>" + description + "<br>" + image;

			var infowindow = new google.maps.InfoWindow({
				content:  content,
			});
			google.maps.event.addListener(marker, 'click', function(){
					infowindow.open(map, marker);
			});

		}

		function setAllMap(map) {
			for (var i = 0; i < markers.length; i++) {
		    	markers[i].setMap(map);
		  	}
		}

		function removeGemLoc() {
			setAllMap(null);
			markers = [];
		}


		google.maps.event.addDomListener(window, 'load', initialize);
		</script>
</html>